// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Game {
  id              String   @id
  espnId          String?  @unique
  sportsRadarId   String?  @unique

  homeTeamId      String
  awayTeamId      String
  homeTeam        Team     @relation("HomeTeam", fields: [homeTeamId], references: [id])
  awayTeam        Team     @relation("AwayTeam", fields: [awayTeamId], references: [id])

  status          String   // 'scheduled', 'live', 'completed', 'postponed', 'cancelled'
  homeScore       Int      @default(0)
  awayScore       Int      @default(0)

  scheduledAt     DateTime
  startedAt       DateTime?
  completedAt     DateTime?

  season          Int
  seasonType      String   // 'preseason', 'regular', 'postseason'
  week            Int?

  period          String?  // Current period: '1', '2', '3', '4', 'OT', 'HALFTIME'
  clock           String?  // Time remaining in period

  venueId         String?
  venue           Venue?   @relation(fields: [venueId], references: [id])

  attendance      Int?
  weather         String?  // JSON string with weather data
  broadcasts      String?  // JSON array with broadcast info
  periodScores    String?  // JSON array with period-by-period scores

  lastModified    DateTime @updatedAt
  createdAt       DateTime @default(now())

  @@index([espnId])
  @@index([sportsRadarId])
  @@index([season, week])
  @@index([status])
  @@index([scheduledAt])
}

model Team {
  id              String   @id
  abbreviation    String   @unique
  displayName     String
  location        String?
  nickname        String?
  color           String?
  logo            String?

  homeGames      Game[]   @relation("HomeTeam")
  awayGames      Game[]   @relation("AwayTeam")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([abbreviation])
  @@index([displayName])
}

model Venue {
  id              String   @id
  name            String
  city            String
  state           String?
  capacity        Int?
  surface         String?
  indoor          Boolean?

  games           Game[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([city])
  @@index([name])
}
